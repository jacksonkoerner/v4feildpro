<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>System Setup - Permissions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dot-navy': '#0a1628',
                        'dot-blue': '#1e3a5f',
                        'dot-slate': '#334155',
                        'dot-orange': '#ea580c',
                        'dot-yellow': '#f59e0b',
                        'safety-green': '#16a34a',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .header-stripe { background: repeating-linear-gradient(-45deg, #f59e0b, #f59e0b 10px, #0a1628 10px, #0a1628 20px); height: 4px; }
        .permission-card { transition: all 0.3s ease; }
        .permission-card.success { border-color: #16a34a; background-color: rgba(22, 163, 74, 0.05); }
        .permission-card.error { border-color: #dc2626; background-color: rgba(220, 38, 38, 0.05); }
        .permission-card.warning { border-color: #ea580c; background-color: rgba(234, 88, 12, 0.05); }
        .permission-card.testing { border-color: #1e3a5f; background-color: rgba(30, 58, 95, 0.05); }
        @keyframes pulse-check { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .pulse-check { animation: pulse-check 0.5s ease-in-out; }
        .mic-level { transition: width 0.1s ease-out; }
        @keyframes recording-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0.5); }
            50% { box-shadow: 0 0 0 8px rgba(234, 88, 12, 0); }
        }
        .recording-active { animation: recording-pulse 1.5s ease-out infinite; }
        .debug-log { font-family: 'SF Mono', Monaco, 'Courier New', monospace; font-size: 11px; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen">
    <div class="header-stripe"></div>

    <div class="max-w-lg mx-auto min-h-screen flex flex-col">

        <!-- HEADER -->
        <header class="bg-dot-navy text-white p-6 text-center">
            <div class="w-20 h-20 bg-dot-yellow flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-shield-alt text-dot-navy text-3xl"></i>
            </div>
            <h1 class="text-2xl font-bold">System Setup</h1>
            <p class="text-sm text-slate-400 mt-1">Configure & test required permissions</p>
        </header>

        <!-- MAIN CONTENT -->
        <main class="flex-1 p-4 space-y-4">

            <!-- Device Info Banner -->
            <div id="deviceInfo" class="bg-slate-800 border border-slate-700 p-3">
                <p class="text-[10px] text-slate-400 uppercase tracking-wider mb-1">Device Detection</p>
                <p id="deviceInfoText" class="text-xs text-slate-300 font-mono">Detecting...</p>
            </div>

            <!-- ==================== MICROPHONE SECTION ==================== -->
            <div id="micCard" class="permission-card bg-white border-2 border-slate-200">
                <div class="p-4">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-dot-navy flex items-center justify-center flex-shrink-0">
                            <i id="micIcon" class="fas fa-microphone text-dot-yellow text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h2 class="font-bold text-slate-800 uppercase text-sm">Microphone Access</h2>
                            <p id="micStatus" class="text-sm text-slate-500 mt-1">Required for voice recording</p>
                            <p id="micError" class="text-xs text-red-500 mt-1 hidden"></p>
                        </div>
                        <button id="micBtn" onclick="requestMicrophone()" class="px-4 py-2 bg-dot-navy hover:bg-dot-blue text-white font-bold text-xs uppercase transition-colors">
                            Enable
                        </button>
                    </div>
                </div>
            </div>

            <!-- ==================== MIC TEST SECTION ==================== -->
            <div id="micTestCard" class="permission-card bg-white border-2 border-slate-200 hidden">
                <div class="p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 bg-dot-orange flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-waveform text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h2 class="font-bold text-slate-800 uppercase text-sm">Microphone Test</h2>
                            <p class="text-xs text-slate-500">Speak to verify audio input is working</p>
                        </div>
                    </div>

                    <!-- Level Meter -->
                    <div class="bg-slate-100 border border-slate-200 p-3 mb-3">
                        <p class="text-[10px] text-slate-400 uppercase mb-2">Audio Level</p>
                        <div class="h-4 bg-slate-200 overflow-hidden">
                            <div id="micLevel" class="mic-level h-full bg-safety-green" style="width: 0%"></div>
                        </div>
                        <p id="micLevelText" class="text-xs text-slate-500 mt-1">Waiting for audio...</p>
                    </div>

                    <div class="flex gap-2">
                        <button id="micTestBtn" onclick="startMicTest()" class="flex-1 px-4 py-3 bg-dot-orange hover:bg-orange-700 text-white font-bold text-xs uppercase transition-colors">
                            <i class="fas fa-microphone mr-2"></i>Start Test
                        </button>
                        <button id="micTestStopBtn" onclick="stopMicTest()" class="hidden flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-bold text-xs uppercase transition-colors recording-active">
                            <i class="fas fa-stop mr-2"></i>Stop Test
                        </button>
                    </div>
                    <p id="micTestResult" class="text-xs text-center mt-2 hidden"></p>
                </div>
            </div>

            <!-- ==================== SPEECH RECOGNITION SECTION ==================== -->
            <div id="speechCard" class="permission-card bg-white border-2 border-slate-200">
                <div class="p-4">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-violet-600 flex items-center justify-center flex-shrink-0">
                            <i id="speechIcon" class="fas fa-comment-dots text-white text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h2 class="font-bold text-slate-800 uppercase text-sm">Speech Recognition</h2>
                            <p id="speechStatus" class="text-sm text-slate-500 mt-1">Required for voice-to-text</p>
                            <p id="speechError" class="text-xs text-red-500 mt-1 hidden"></p>
                        </div>
                        <button id="speechBtn" onclick="testSpeechRecognition()" class="px-4 py-2 bg-violet-600 hover:bg-violet-700 text-white font-bold text-xs uppercase transition-colors">
                            Test
                        </button>
                    </div>

                    <!-- Speech Test Area -->
                    <div id="speechTestArea" class="hidden mt-4 p-3 bg-violet-50 border border-violet-200">
                        <p class="text-xs text-violet-600 uppercase font-bold mb-2">Say something...</p>
                        <p id="speechTranscript" class="text-sm text-slate-700 italic min-h-[40px]">Listening...</p>
                    </div>

                    <!-- iOS Help Panel -->
                    <div id="iosHelpPanel" class="hidden mt-4 bg-red-50 border-2 border-red-200">
                        <div class="p-3 bg-red-100 border-b border-red-200">
                            <p class="text-sm font-bold text-red-700 uppercase flex items-center gap-2">
                                <i class="fab fa-apple"></i> iOS Safari - Siri & Dictation Required
                            </p>
                        </div>
                        <div class="p-4 space-y-4">
                            <p class="text-xs text-red-600">
                                iOS Safari uses Apple's Siri servers for speech recognition. You must enable <strong>Siri</strong> and <strong>Dictation</strong> in your device settings.
                            </p>

                            <div class="space-y-3">
                                <div class="bg-white p-3 border border-red-200">
                                    <p class="text-xs font-bold text-slate-700 uppercase mb-2">Step 1: Enable Siri</p>
                                    <ol class="text-xs text-slate-600 space-y-1 list-decimal list-inside">
                                        <li>Open <strong>Settings</strong> app</li>
                                        <li>Tap <strong>Siri & Search</strong> (or <strong>Siri</strong>)</li>
                                        <li>Enable <strong>"Listen for 'Hey Siri'"</strong> OR <strong>"Press Side Button for Siri"</strong></li>
                                        <li>Follow setup prompts if asked</li>
                                    </ol>
                                </div>

                                <div class="bg-white p-3 border border-red-200">
                                    <p class="text-xs font-bold text-slate-700 uppercase mb-2">Step 2: Enable Dictation</p>
                                    <ol class="text-xs text-slate-600 space-y-1 list-decimal list-inside">
                                        <li>Open <strong>Settings</strong> app</li>
                                        <li>Tap <strong>General</strong></li>
                                        <li>Tap <strong>Keyboard</strong></li>
                                        <li>Scroll down and enable <strong>"Enable Dictation"</strong></li>
                                        <li>Confirm when prompted</li>
                                    </ol>
                                </div>

                                <div class="bg-white p-3 border border-red-200">
                                    <p class="text-xs font-bold text-slate-700 uppercase mb-2">Step 3: Reload & Test</p>
                                    <ol class="text-xs text-slate-600 space-y-1 list-decimal list-inside">
                                        <li>Close Safari completely (swipe up from app switcher)</li>
                                        <li>Reopen Safari and navigate back to this page</li>
                                        <li>Tap "Test" on Speech Recognition again</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="bg-yellow-50 border border-yellow-300 p-3">
                                <p class="text-xs text-yellow-700">
                                    <i class="fas fa-lightbulb mr-1"></i>
                                    <strong>Still not working?</strong> Check Settings > Privacy & Security > Speech Recognition and ensure it's enabled for Safari.
                                </p>
                            </div>

                            <button onclick="testSpeechRecognition()" class="w-full px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-bold text-xs uppercase transition-colors">
                                <i class="fas fa-redo mr-2"></i>Try Speech Recognition Again
                            </button>

                            <!-- Alternative: Groq Whisper -->
                            <div class="mt-4 pt-4 border-t-2 border-red-200">
                                <div class="bg-safety-green/10 border-2 border-safety-green p-3">
                                    <p class="text-xs font-bold text-safety-green uppercase flex items-center gap-2 mb-2">
                                        <i class="fas fa-magic"></i> Alternative: AI Transcription
                                    </p>
                                    <p class="text-xs text-slate-600 mb-3">
                                        Skip the Siri/Dictation hassle! Use <strong>Groq Whisper AI</strong> for speech-to-text instead.
                                        It's free, fast, and works reliably on any device.
                                    </p>
                                    <div class="space-y-2">
                                        <p class="text-xs text-slate-500">
                                            <strong>1.</strong> Get a free API key at <a href="https://console.groq.com" target="_blank" class="text-dot-blue underline font-bold">console.groq.com</a>
                                        </p>
                                        <p class="text-xs text-slate-500">
                                            <strong>2.</strong> Enter the key on the Review page
                                        </p>
                                        <p class="text-xs text-slate-500">
                                            <strong>3.</strong> Voice recording will automatically use AI transcription
                                        </p>
                                    </div>
                                    <a href="#apiKeyCard" onclick="document.getElementById('apiKeyCard').scrollIntoView({behavior:'smooth'}); document.getElementById('apiKeyInput').focus();" class="mt-3 w-full block text-center px-4 py-3 bg-safety-green hover:bg-green-700 text-white font-bold text-xs uppercase transition-colors cursor-pointer">
                                        <i class="fas fa-key mr-2"></i>Set Up API Key Below
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== LOCATION SECTION ==================== -->
            <div id="locCard" class="permission-card bg-white border-2 border-slate-200">
                <div class="p-4">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-safety-green flex items-center justify-center flex-shrink-0">
                            <i id="locIcon" class="fas fa-location-dot text-white text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h2 class="font-bold text-slate-800 uppercase text-sm">Location Access</h2>
                            <p id="locStatus" class="text-sm text-slate-500 mt-1">Required for weather & GPS photos</p>
                            <p id="locError" class="text-xs text-red-500 mt-1 hidden"></p>
                        </div>
                        <button id="locBtn" onclick="requestLocation()" class="px-4 py-2 bg-safety-green hover:bg-green-700 text-white font-bold text-xs uppercase transition-colors">
                            Enable
                        </button>
                    </div>
                </div>
            </div>

            <!-- ==================== CAMERA SECTION ==================== -->
            <div id="camCard" class="permission-card bg-white border-2 border-slate-200">
                <div class="p-4">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-dot-orange flex items-center justify-center flex-shrink-0">
                            <i id="camIcon" class="fas fa-camera text-white text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h2 class="font-bold text-slate-800 uppercase text-sm">Camera Access</h2>
                            <p id="camStatus" class="text-sm text-slate-500 mt-1">Required for progress photos</p>
                            <p id="camError" class="text-xs text-red-500 mt-1 hidden"></p>
                        </div>
                        <button id="camBtn" onclick="requestCamera()" class="px-4 py-2 bg-dot-orange hover:bg-orange-700 text-white font-bold text-xs uppercase transition-colors">
                            Enable
                        </button>
                    </div>
                </div>
            </div>

            <!-- ==================== GROQ API KEY SECTION ==================== -->
            <div id="apiKeyCard" class="permission-card bg-white border-2 border-slate-200">
                <div class="p-4">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-dot-yellow flex items-center justify-center flex-shrink-0">
                            <i id="apiKeyIcon" class="fas fa-key text-dot-navy text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h2 class="font-bold text-slate-800 uppercase text-sm">Groq API Key</h2>
                            <p id="apiKeyStatus" class="text-sm text-slate-500 mt-1">Required for voice transcription & AI</p>
                        </div>
                        <div id="apiKeyBadge" class="hidden px-3 py-1 bg-safety-green text-white text-xs font-bold uppercase">
                            <i class="fas fa-check mr-1"></i>Saved
                        </div>
                    </div>

                    <div class="mt-4 pt-4 border-t border-slate-200">
                        <p class="text-xs text-slate-600 mb-3">
                            Get a free API key at <a href="https://console.groq.com" target="_blank" class="underline text-dot-blue font-bold">console.groq.com</a>
                        </p>
                        <div class="flex gap-2">
                            <input type="password" id="apiKeyInput" class="flex-1 bg-white border-2 border-slate-300 px-4 py-2 text-sm text-slate-800 placeholder-slate-400 focus:outline-none focus:border-dot-blue" placeholder="gsk_...">
                            <button onclick="saveApiKey()" class="px-4 py-2 bg-dot-orange hover:bg-orange-700 text-white font-bold uppercase text-sm transition-colors">
                                Save
                            </button>
                        </div>
                        <p id="apiKeyMessage" class="text-xs mt-2 hidden"></p>

                        <div class="mt-3 bg-slate-50 border border-slate-200 p-3">
                            <p class="text-xs text-slate-500">
                                <i class="fas fa-info-circle text-dot-blue mr-1"></i>
                                <strong>Used for:</strong> Voice-to-text on iPhone, AI report refinement
                            </p>
                            <p class="text-xs text-slate-400 mt-1">
                                <i class="fas fa-dollar-sign mr-1"></i>
                                Cost: ~$0.04/hour of audio (essentially free)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== STATUS SUMMARY ==================== -->
            <div id="statusSummary" class="bg-white border-2 border-slate-200 p-4">
                <div class="flex items-center gap-3">
                    <div id="summaryIcon" class="w-10 h-10 bg-slate-200 flex items-center justify-center">
                        <i class="fas fa-clock text-slate-400"></i>
                    </div>
                    <div>
                        <p id="summaryTitle" class="font-bold text-slate-800 text-sm uppercase">Setup Required</p>
                        <p id="summaryText" class="text-xs text-slate-500">Enable permissions above to continue</p>
                    </div>
                </div>
            </div>

            <!-- ==================== DEBUG CONSOLE ==================== -->
            <div class="bg-slate-900 border border-slate-700">
                <button onclick="toggleDebug()" class="w-full p-3 flex items-center justify-between text-left">
                    <span class="text-xs text-slate-400 uppercase font-bold"><i class="fas fa-bug mr-2"></i>Debug Console</span>
                    <i id="debugToggleIcon" class="fas fa-chevron-down text-slate-500 text-xs"></i>
                </button>
                <div id="debugConsole" class="hidden border-t border-slate-700">
                    <div id="debugLog" class="debug-log p-3 max-h-48 overflow-y-auto text-slate-300 space-y-1">
                        <p class="text-slate-500">// Debug log initialized</p>
                    </div>
                    <div class="border-t border-slate-700 p-2 flex gap-2">
                        <button onclick="copyDebugLog()" class="flex-1 px-3 py-2 bg-slate-700 hover:bg-slate-600 text-slate-300 text-xs font-bold uppercase">
                            <i class="fas fa-copy mr-1"></i>Copy Log
                        </button>
                        <button onclick="clearDebugLog()" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-slate-300 text-xs font-bold uppercase">
                            <i class="fas fa-trash mr-1"></i>Clear
                        </button>
                    </div>
                </div>
            </div>

        </main>

        <!-- CONTINUE BUTTON -->
        <div class="p-4 bg-white border-t border-slate-200">
            <button id="continueBtn" onclick="finishSetup()" class="w-full p-4 bg-safety-green hover:bg-green-700 text-white font-bold uppercase transition-colors flex items-center justify-center gap-2">
                <span id="continueBtnText">Continue to Dashboard</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- FOOTER -->
        <footer class="bg-dot-navy text-center py-3">
            <p class="text-[10px] text-slate-500 uppercase tracking-widest">
                <i class="fas fa-shield-alt mr-1"></i>
                DOT Compliant Field Documentation System
            </p>
        </footer>
    </div>

    <script>
        // ============ STATE ============
        let permissions = { mic: false, speech: false, loc: false, cam: false };
        let micStream = null;
        let audioContext = null;
        let analyser = null;
        let micTestInterval = null;
        let recognition = null;
        let debugLogs = [];

        // ============ DEVICE DETECTION ============
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        const isIOSSafari = isIOS && isSafari;
        const isChrome = /Chrome/.test(navigator.userAgent);
        const isFirefox = /Firefox/.test(navigator.userAgent);
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isSecureContext = window.isSecureContext;
        const hasMediaDevices = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
        const hasSpeechRecognition = !!( window.SpeechRecognition || window.webkitSpeechRecognition);

        // ============ DEBUG LOGGING ============
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = { info: 'text-slate-300', success: 'text-green-400', error: 'text-red-400', warn: 'text-yellow-400' };
            const icons = { info: 'ℹ️', success: '✅', error: '❌', warn: '⚠️' };

            const logEntry = `[${timestamp}] ${icons[type]} ${message}`;
            debugLogs.push(logEntry);

            const logEl = document.getElementById('debugLog');
            const p = document.createElement('p');
            p.className = colors[type];
            p.textContent = logEntry;
            logEl.appendChild(p);
            logEl.scrollTop = logEl.scrollHeight;

            console.log(`[Permissions] ${message}`);
        }

        function toggleDebug() {
            const console = document.getElementById('debugConsole');
            const icon = document.getElementById('debugToggleIcon');
            console.classList.toggle('hidden');
            icon.className = console.classList.contains('hidden') ? 'fas fa-chevron-down text-slate-500 text-xs' : 'fas fa-chevron-up text-slate-500 text-xs';
        }

        function copyDebugLog() {
            const text = debugLogs.join('\n');
            navigator.clipboard.writeText(text).then(() => {
                log('Debug log copied to clipboard', 'success');
            }).catch(err => {
                log('Failed to copy: ' + err.message, 'error');
            });
        }

        function clearDebugLog() {
            debugLogs = [];
            document.getElementById('debugLog').innerHTML = '<p class="text-slate-500">// Debug log cleared</p>';
        }

        // ============ ERROR CODE MAPPING ============
        const errorCodes = {
            // MediaDevices errors
            'NotAllowedError': { code: 'ERR_001', message: 'Permission denied by user or system', fix: 'Tap the lock icon in address bar > Site Settings > Allow microphone' },
            'NotFoundError': { code: 'ERR_002', message: 'No microphone found on device', fix: 'Connect a microphone or check device settings' },
            'NotReadableError': { code: 'ERR_003', message: 'Microphone is in use by another app', fix: 'Close other apps using the microphone (Zoom, Teams, etc.)' },
            'OverconstrainedError': { code: 'ERR_004', message: 'Microphone constraints cannot be satisfied', fix: 'Try a different microphone or restart browser' },
            'AbortError': { code: 'ERR_005', message: 'Request was aborted', fix: 'Try again or restart browser' },
            'SecurityError': { code: 'ERR_006', message: 'Security policy blocked access', fix: 'Ensure you are on HTTPS or localhost' },
            'TypeError': { code: 'ERR_007', message: 'Invalid request or browser incompatible', fix: 'Update your browser to latest version' },

            // Speech Recognition errors
            'no-speech': { code: 'SPE_001', message: 'No speech detected', fix: 'Speak louder or check microphone' },
            'aborted': { code: 'SPE_002', message: 'Speech recognition aborted', fix: 'Try again' },
            'audio-capture': { code: 'SPE_003', message: 'Audio capture failed', fix: 'Check microphone permissions' },
            'network': { code: 'SPE_004', message: 'Network error for speech service', fix: 'Check internet connection' },
            'not-allowed': { code: 'SPE_005', message: 'Speech recognition not allowed', fix: 'Enable microphone permission and reload page' },
            'service-not-allowed': { code: 'SPE_006', message: 'Speech service blocked by iOS', fix: 'Enable Siri & Dictation in iOS Settings (see instructions below)' },
            'bad-grammar': { code: 'SPE_007', message: 'Speech grammar error', fix: 'Try again' },
            'language-not-supported': { code: 'SPE_008', message: 'Language not supported', fix: 'Change device language to English' },

            // Geolocation errors
            'PERMISSION_DENIED': { code: 'GEO_001', message: 'Location permission denied', fix: 'Enable location in browser and device settings' },
            'POSITION_UNAVAILABLE': { code: 'GEO_002', message: 'Location unavailable', fix: 'Move to area with better GPS signal' },
            'TIMEOUT': { code: 'GEO_003', message: 'Location request timed out', fix: 'Try again in area with better signal' },
        };

        function getErrorInfo(error, type = 'media') {
            const name = error.name || error.error || error.message || String(error);
            const code = error.code;

            // Check for geolocation error codes
            if (code === 1) return errorCodes['PERMISSION_DENIED'];
            if (code === 2) return errorCodes['POSITION_UNAVAILABLE'];
            if (code === 3) return errorCodes['TIMEOUT'];

            return errorCodes[name] || {
                code: 'ERR_UNK',
                message: name || 'Unknown error',
                fix: 'Try restarting browser or device'
            };
        }

        // ============ MICROPHONE ============
        async function requestMicrophone() {
            const card = document.getElementById('micCard');
            const btn = document.getElementById('micBtn');
            const icon = document.getElementById('micIcon');
            const status = document.getElementById('micStatus');
            const errorEl = document.getElementById('micError');

            card.className = 'permission-card bg-white border-2 testing';
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;
            status.textContent = 'Requesting microphone access...';
            errorEl.classList.add('hidden');

            log('Requesting microphone permission...');

            // Check if mediaDevices API exists
            if (!hasMediaDevices) {
                log('MediaDevices API not available', 'error');
                showMicError('ERR_API', 'MediaDevices API not supported', 'Use a modern browser (Chrome, Safari, Firefox)');
                return;
            }

            // Check secure context
            if (!isSecureContext) {
                log('Not in secure context (HTTPS required)', 'error');
                showMicError('ERR_SEC', 'HTTPS required for microphone', 'Access this page via HTTPS');
                return;
            }

            try {
                log('Calling getUserMedia({ audio: true })...');
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                // Get device info
                const audioTracks = stream.getAudioTracks();
                if (audioTracks.length > 0) {
                    const track = audioTracks[0];
                    log(`Microphone: ${track.label}`, 'success');
                    log(`Track state: ${track.readyState}`, 'info');
                    log(`Track enabled: ${track.enabled}`, 'info');

                    const settings = track.getSettings();
                    if (settings.sampleRate) log(`Sample rate: ${settings.sampleRate}Hz`, 'info');
                    if (settings.channelCount) log(`Channels: ${settings.channelCount}`, 'info');
                }

                stream.getTracks().forEach(track => track.stop());

                permissions.mic = true;
                localStorage.setItem('fvp_mic_granted', 'true');
                localStorage.setItem('fvp_mic_timestamp', Date.now().toString());

                card.className = 'permission-card bg-white border-2 success';
                icon.className = 'fas fa-check text-safety-green text-xl pulse-check';
                btn.innerHTML = '<i class="fas fa-check"></i>';
                btn.className = 'px-4 py-2 bg-safety-green text-white font-bold text-xs uppercase cursor-default';
                status.textContent = 'Microphone enabled';
                status.className = 'text-sm text-safety-green mt-1 font-medium';

                log('Microphone permission granted!', 'success');

                // Show mic test section
                document.getElementById('micTestCard').classList.remove('hidden');

            } catch (err) {
                log(`Microphone error: ${err.name} - ${err.message}`, 'error');
                const errInfo = getErrorInfo(err);
                showMicError(errInfo.code, errInfo.message, errInfo.fix);
            }
            updateSummary();
        }

        function showMicError(code, message, fix) {
            const card = document.getElementById('micCard');
            const btn = document.getElementById('micBtn');
            const icon = document.getElementById('micIcon');
            const status = document.getElementById('micStatus');
            const errorEl = document.getElementById('micError');

            card.className = 'permission-card bg-white border-2 error';
            icon.className = 'fas fa-microphone-slash text-red-500 text-xl';
            btn.innerHTML = 'Retry';
            btn.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold text-xs uppercase transition-colors';
            btn.disabled = false;
            status.textContent = `Error: ${message}`;
            status.className = 'text-sm text-red-500 mt-1';
            errorEl.innerHTML = `<strong>${code}</strong>: ${fix}`;
            errorEl.classList.remove('hidden');
        }

        // ============ MIC TEST ============
        async function startMicTest() {
            log('Starting microphone test...');

            try {
                micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(micStream);
                source.connect(analyser);
                analyser.fftSize = 256;

                document.getElementById('micTestBtn').classList.add('hidden');
                document.getElementById('micTestStopBtn').classList.remove('hidden');

                const dataArray = new Uint8Array(analyser.frequencyBinCount);
                let maxLevel = 0;

                micTestInterval = setInterval(() => {
                    analyser.getByteFrequencyData(dataArray);
                    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    const level = Math.min(100, (average / 128) * 100);

                    if (level > maxLevel) maxLevel = level;

                    const levelBar = document.getElementById('micLevel');
                    const levelText = document.getElementById('micLevelText');

                    levelBar.style.width = `${level}%`;

                    if (level > 50) {
                        levelBar.className = 'mic-level h-full bg-safety-green';
                        levelText.textContent = `Strong signal (${Math.round(level)}%)`;
                        levelText.className = 'text-xs text-safety-green mt-1 font-medium';
                    } else if (level > 20) {
                        levelBar.className = 'mic-level h-full bg-dot-yellow';
                        levelText.textContent = `Moderate signal (${Math.round(level)}%)`;
                        levelText.className = 'text-xs text-dot-yellow mt-1';
                    } else if (level > 5) {
                        levelBar.className = 'mic-level h-full bg-dot-orange';
                        levelText.textContent = `Weak signal (${Math.round(level)}%)`;
                        levelText.className = 'text-xs text-dot-orange mt-1';
                    } else {
                        levelBar.className = 'mic-level h-full bg-slate-400';
                        levelText.textContent = 'No audio detected - speak into mic';
                        levelText.className = 'text-xs text-slate-500 mt-1';
                    }
                }, 100);

                log('Mic test started - speak into microphone', 'info');

            } catch (err) {
                log(`Mic test error: ${err.message}`, 'error');
                const result = document.getElementById('micTestResult');
                result.textContent = `Test failed: ${err.message}`;
                result.className = 'text-xs text-center mt-2 text-red-500';
                result.classList.remove('hidden');
            }
        }

        function stopMicTest() {
            if (micTestInterval) {
                clearInterval(micTestInterval);
                micTestInterval = null;
            }
            if (micStream) {
                micStream.getTracks().forEach(track => track.stop());
                micStream = null;
            }
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }

            document.getElementById('micTestBtn').classList.remove('hidden');
            document.getElementById('micTestStopBtn').classList.add('hidden');

            const levelBar = document.getElementById('micLevel');
            const level = parseFloat(levelBar.style.width) || 0;

            const result = document.getElementById('micTestResult');
            if (level > 20) {
                result.textContent = '✅ Microphone is working correctly';
                result.className = 'text-xs text-center mt-2 text-safety-green font-medium';
                log('Mic test passed - audio detected', 'success');
            } else {
                result.textContent = '⚠️ Low audio - check microphone placement';
                result.className = 'text-xs text-center mt-2 text-dot-orange font-medium';
                log('Mic test warning - low audio levels', 'warn');
            }
            result.classList.remove('hidden');
        }

        // ============ SPEECH RECOGNITION ============
        async function testSpeechRecognition() {
            const card = document.getElementById('speechCard');
            const btn = document.getElementById('speechBtn');
            const icon = document.getElementById('speechIcon');
            const status = document.getElementById('speechStatus');
            const errorEl = document.getElementById('speechError');
            const testArea = document.getElementById('speechTestArea');
            const transcript = document.getElementById('speechTranscript');

            log('Testing speech recognition...');

            // Check if API exists
            if (!hasSpeechRecognition) {
                log('SpeechRecognition API not available', 'error');
                showSpeechError('SPE_API', 'Speech Recognition not supported', 'Use Chrome, Safari, or Edge browser');
                return;
            }

            card.className = 'permission-card bg-white border-2 testing';
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;
            status.textContent = 'Starting speech recognition...';
            errorEl.classList.add('hidden');
            testArea.classList.remove('hidden');
            transcript.textContent = 'Listening... (say something)';

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            recognition.maxAlternatives = 1;

            log(`SpeechRecognition config: lang=${recognition.lang}, continuous=${recognition.continuous}`, 'info');

            let hasResult = false;
            let timeout = null;

            recognition.onstart = () => {
                log('Speech recognition started', 'info');
                status.textContent = 'Listening...';

                // Timeout after 10 seconds
                timeout = setTimeout(() => {
                    if (!hasResult) {
                        log('Speech recognition timeout - no speech detected', 'warn');
                        recognition.stop();
                    }
                }, 10000);
            };

            recognition.onresult = (event) => {
                hasResult = true;
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    if (result.isFinal) {
                        finalTranscript += result[0].transcript;
                    } else {
                        interimTranscript += result[0].transcript;
                    }
                }

                transcript.textContent = finalTranscript || interimTranscript || 'Listening...';

                if (finalTranscript) {
                    log(`Speech recognized: "${finalTranscript}"`, 'success');
                }
            };

            recognition.onend = () => {
                clearTimeout(timeout);
                log('Speech recognition ended', 'info');

                if (hasResult) {
                    permissions.speech = true;
                    localStorage.setItem('fvp_speech_granted', 'true');

                    card.className = 'permission-card bg-white border-2 success';
                    icon.className = 'fas fa-check text-safety-green text-xl pulse-check';
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.className = 'px-4 py-2 bg-safety-green text-white font-bold text-xs uppercase cursor-default';
                    status.textContent = 'Speech recognition working';
                    status.className = 'text-sm text-safety-green mt-1 font-medium';
                    log('Speech recognition test passed!', 'success');
                } else {
                    card.className = 'permission-card bg-white border-2 warning';
                    icon.className = 'fas fa-comment-slash text-dot-orange text-xl';
                    btn.innerHTML = 'Retry';
                    btn.className = 'px-4 py-2 bg-dot-orange hover:bg-orange-700 text-white font-bold text-xs uppercase transition-colors';
                    btn.disabled = false;
                    status.textContent = 'No speech detected';
                    status.className = 'text-sm text-dot-orange mt-1';
                    transcript.textContent = 'No speech was detected. Try again and speak clearly.';
                }
                updateSummary();
            };

            recognition.onerror = (event) => {
                clearTimeout(timeout);
                log(`Speech recognition error: ${event.error}`, 'error');

                // Additional debugging for iOS
                if (isIOS) {
                    log(`iOS version detected from UA`, 'info');
                    if (event.error === 'service-not-allowed') {
                        log('SPE_006: This error means Siri/Dictation is not enabled on this iOS device', 'error');
                        log('User needs to: 1) Enable Siri in Settings, 2) Enable Dictation in Keyboard settings', 'warn');
                    }
                }

                const errInfo = getErrorInfo({ error: event.error });
                showSpeechError(errInfo.code, errInfo.message, errInfo.fix, event.error);
                testArea.classList.add('hidden');
            };

            try {
                recognition.start();
            } catch (err) {
                log(`Failed to start speech recognition: ${err.message}`, 'error');
                showSpeechError('SPE_START', 'Failed to start', 'Reload page and try again');
            }
        }

        function showSpeechError(code, message, fix, errorType = '') {
            const card = document.getElementById('speechCard');
            const btn = document.getElementById('speechBtn');
            const icon = document.getElementById('speechIcon');
            const status = document.getElementById('speechStatus');
            const errorEl = document.getElementById('speechError');
            const iosHelpPanel = document.getElementById('iosHelpPanel');

            card.className = 'permission-card bg-white border-2 error';
            icon.className = 'fas fa-comment-slash text-red-500 text-xl';
            btn.innerHTML = 'Retry';
            btn.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold text-xs uppercase transition-colors';
            btn.disabled = false;
            status.textContent = `Error: ${message}`;
            status.className = 'text-sm text-red-500 mt-1';
            errorEl.innerHTML = `<strong>${code}</strong>: ${fix}`;
            errorEl.classList.remove('hidden');

            // Show iOS help panel for service-not-allowed errors on iOS
            if ((code === 'SPE_006' || errorType === 'service-not-allowed') && isIOS) {
                iosHelpPanel.classList.remove('hidden');
                log('Showing iOS Siri/Dictation help panel', 'info');
            } else {
                iosHelpPanel.classList.add('hidden');
            }

            updateSummary();
        }

        // ============ LOCATION ============
        async function requestLocation() {
            const card = document.getElementById('locCard');
            const btn = document.getElementById('locBtn');
            const icon = document.getElementById('locIcon');
            const status = document.getElementById('locStatus');
            const errorEl = document.getElementById('locError');

            card.className = 'permission-card bg-white border-2 testing';
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;
            status.textContent = 'Getting location...';
            errorEl.classList.add('hidden');

            log('Requesting location permission...');

            if (!navigator.geolocation) {
                log('Geolocation API not available', 'error');
                showLocError('GEO_API', 'Geolocation not supported', 'Use a modern browser');
                return;
            }

            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    });
                });

                log(`Location: ${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`, 'success');
                log(`Accuracy: ${position.coords.accuracy.toFixed(0)}m`, 'info');

                permissions.loc = true;
                localStorage.setItem('fvp_loc_granted', 'true');

                card.className = 'permission-card bg-white border-2 success';
                icon.className = 'fas fa-check text-safety-green text-xl pulse-check';
                btn.innerHTML = '<i class="fas fa-check"></i>';
                btn.className = 'px-4 py-2 bg-safety-green text-white font-bold text-xs uppercase cursor-default';
                status.textContent = `Location enabled (±${Math.round(position.coords.accuracy)}m)`;
                status.className = 'text-sm text-safety-green mt-1 font-medium';

            } catch (err) {
                log(`Location error: code=${err.code}, message=${err.message}`, 'error');
                const errInfo = getErrorInfo(err);
                showLocError(errInfo.code, errInfo.message, errInfo.fix);
            }
            updateSummary();
        }

        function showLocError(code, message, fix) {
            const card = document.getElementById('locCard');
            const btn = document.getElementById('locBtn');
            const icon = document.getElementById('locIcon');
            const status = document.getElementById('locStatus');
            const errorEl = document.getElementById('locError');

            card.className = 'permission-card bg-white border-2 error';
            icon.className = 'fas fa-location-crosshairs text-red-500 text-xl';
            btn.innerHTML = 'Retry';
            btn.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold text-xs uppercase transition-colors';
            btn.disabled = false;
            status.textContent = `Error: ${message}`;
            status.className = 'text-sm text-red-500 mt-1';
            errorEl.innerHTML = `<strong>${code}</strong>: ${fix}`;
            errorEl.classList.remove('hidden');
        }

        // ============ CAMERA ============
        async function requestCamera() {
            const card = document.getElementById('camCard');
            const btn = document.getElementById('camBtn');
            const icon = document.getElementById('camIcon');
            const status = document.getElementById('camStatus');
            const errorEl = document.getElementById('camError');

            card.className = 'permission-card bg-white border-2 testing';
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;
            status.textContent = 'Testing camera...';
            errorEl.classList.add('hidden');

            log('Requesting camera permission...');

            if (!hasMediaDevices) {
                log('MediaDevices API not available', 'error');
                showCamError('CAM_API', 'Camera API not supported', 'Use a modern browser');
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });

                const videoTracks = stream.getVideoTracks();
                if (videoTracks.length > 0) {
                    log(`Camera: ${videoTracks[0].label}`, 'success');
                }

                stream.getTracks().forEach(track => track.stop());

                permissions.cam = true;
                localStorage.setItem('fvp_cam_granted', 'true');

                card.className = 'permission-card bg-white border-2 success';
                icon.className = 'fas fa-check text-safety-green text-xl pulse-check';
                btn.innerHTML = '<i class="fas fa-check"></i>';
                btn.className = 'px-4 py-2 bg-safety-green text-white font-bold text-xs uppercase cursor-default';
                status.textContent = 'Camera enabled';
                status.className = 'text-sm text-safety-green mt-1 font-medium';

            } catch (err) {
                log(`Camera error: ${err.name} - ${err.message}`, 'error');
                const errInfo = getErrorInfo(err);
                showCamError(errInfo.code, errInfo.message, errInfo.fix);
            }
            updateSummary();
        }

        function showCamError(code, message, fix) {
            const card = document.getElementById('camCard');
            const btn = document.getElementById('camBtn');
            const icon = document.getElementById('camIcon');
            const status = document.getElementById('camStatus');
            const errorEl = document.getElementById('camError');

            card.className = 'permission-card bg-white border-2 error';
            icon.className = 'fas fa-camera-slash text-red-500 text-xl';
            btn.innerHTML = 'Retry';
            btn.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold text-xs uppercase transition-colors';
            btn.disabled = false;
            status.textContent = `Error: ${message}`;
            status.className = 'text-sm text-red-500 mt-1';
            errorEl.innerHTML = `<strong>${code}</strong>: ${fix}`;
            errorEl.classList.remove('hidden');
        }

        // ============ SUMMARY ============
        function updateSummary() {
            const summary = document.getElementById('statusSummary');
            const icon = document.getElementById('summaryIcon');
            const title = document.getElementById('summaryTitle');
            const text = document.getElementById('summaryText');

            const enabledCount = Object.values(permissions).filter(v => v).length;
            const totalRequired = 4; // mic, speech, loc, cam

            if (enabledCount === totalRequired) {
                summary.className = 'bg-safety-green/10 border-2 border-safety-green p-4';
                icon.className = 'w-10 h-10 bg-safety-green flex items-center justify-center';
                icon.innerHTML = '<i class="fas fa-check text-white"></i>';
                title.textContent = 'All Systems Ready';
                title.className = 'font-bold text-safety-green text-sm uppercase';
                text.textContent = 'Full functionality enabled';
                text.className = 'text-xs text-safety-green';
            } else if (enabledCount >= 2) {
                summary.className = 'bg-dot-orange/10 border-2 border-dot-orange p-4';
                icon.className = 'w-10 h-10 bg-dot-orange flex items-center justify-center';
                icon.innerHTML = '<i class="fas fa-exclamation text-white"></i>';
                title.textContent = `${enabledCount}/${totalRequired} Permissions`;
                title.className = 'font-bold text-dot-orange text-sm uppercase';
                text.textContent = 'Some features may be limited';
                text.className = 'text-xs text-dot-orange';
            } else {
                summary.className = 'bg-white border-2 border-slate-200 p-4';
                icon.className = 'w-10 h-10 bg-slate-200 flex items-center justify-center';
                icon.innerHTML = '<i class="fas fa-clock text-slate-400"></i>';
                title.textContent = 'Setup Required';
                title.className = 'font-bold text-slate-800 text-sm uppercase';
                text.textContent = 'Enable permissions above';
                text.className = 'text-xs text-slate-500';
            }
        }

        function finishSetup() {
            localStorage.setItem('fvp_onboarded', 'true');
            log('Setup complete - redirecting to dashboard', 'success');
            window.location.href = 'index.html';
        }

        // ============ GROQ API KEY ============
        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            const key = input.value.trim();
            const message = document.getElementById('apiKeyMessage');
            const badge = document.getElementById('apiKeyBadge');
            const card = document.getElementById('apiKeyCard');

            if (!key) {
                message.textContent = 'Please enter an API key';
                message.className = 'text-xs mt-2 text-red-500';
                message.classList.remove('hidden');
                log('API key save failed - empty key', 'error');
                return;
            }

            if (!key.startsWith('gsk_')) {
                message.textContent = 'Invalid key format (should start with gsk_)';
                message.className = 'text-xs mt-2 text-dot-orange';
                message.classList.remove('hidden');
                log('API key save failed - invalid format', 'warn');
                return;
            }

            localStorage.setItem('groq_api_key', key);
            message.textContent = 'API key saved successfully!';
            message.className = 'text-xs mt-2 text-safety-green';
            message.classList.remove('hidden');
            badge.classList.remove('hidden');
            card.className = 'permission-card bg-white border-2 success';
            log('Groq API key saved successfully', 'success');

            // Hide message after 3 seconds
            setTimeout(() => {
                message.classList.add('hidden');
            }, 3000);
        }

        function loadApiKey() {
            const saved = localStorage.getItem('groq_api_key');
            if (saved) {
                document.getElementById('apiKeyInput').value = saved;
                document.getElementById('apiKeyBadge').classList.remove('hidden');
                document.getElementById('apiKeyCard').className = 'permission-card bg-white border-2 success';
                document.getElementById('apiKeyStatus').textContent = 'API key configured';
                document.getElementById('apiKeyStatus').className = 'text-sm text-safety-green mt-1 font-medium';
                log('Groq API key loaded from storage', 'info');
            }
        }

        // ============ INIT ============
        function init() {
            // Log device info
            const deviceText = [];
            if (isIOS) deviceText.push('iOS');
            if (isAndroid) deviceText.push('Android');
            if (isSafari) deviceText.push('Safari');
            if (isChrome) deviceText.push('Chrome');
            if (isFirefox) deviceText.push('Firefox');
            if (isMobile) deviceText.push('Mobile');
            if (!isMobile) deviceText.push('Desktop');

            const deviceStr = deviceText.join(' • ') + ` | Secure: ${isSecureContext ? 'Yes' : 'No'}`;
            document.getElementById('deviceInfoText').textContent = deviceStr;

            log('=== Permission Setup Started ===', 'info');
            log(`Device: ${deviceStr}`, 'info');
            log(`MediaDevices API: ${hasMediaDevices ? 'Available' : 'NOT AVAILABLE'}`, hasMediaDevices ? 'info' : 'error');
            log(`SpeechRecognition API: ${hasSpeechRecognition ? 'Available' : 'NOT AVAILABLE'}`, hasSpeechRecognition ? 'info' : 'error');
            log(`User Agent: ${navigator.userAgent}`, 'info');

            // iOS Safari specific warnings
            if (isIOSSafari) {
                log('⚠️ iOS Safari detected - speech recognition requires user gesture', 'warn');
            }

            // Check existing permissions
            checkExistingPermissions();

            // Load API key if saved
            loadApiKey();
        }

        function checkExistingPermissions() {
            log('Checking existing permissions...', 'info');

            if (localStorage.getItem('fvp_mic_granted') === 'true') {
                permissions.mic = true;
                log('Microphone: Previously granted', 'info');
                setPermissionSuccess('mic', 'Microphone', 'micCard', 'micBtn', 'micIcon', 'micStatus');
                document.getElementById('micTestCard').classList.remove('hidden');
            }
            if (localStorage.getItem('fvp_speech_granted') === 'true') {
                permissions.speech = true;
                log('Speech Recognition: Previously granted', 'info');
                setPermissionSuccess('speech', 'Speech Recognition', 'speechCard', 'speechBtn', 'speechIcon', 'speechStatus');
            }
            if (localStorage.getItem('fvp_loc_granted') === 'true') {
                permissions.loc = true;
                log('Location: Previously granted', 'info');
                setPermissionSuccess('loc', 'Location', 'locCard', 'locBtn', 'locIcon', 'locStatus');
            }
            if (localStorage.getItem('fvp_cam_granted') === 'true') {
                permissions.cam = true;
                log('Camera: Previously granted', 'info');
                setPermissionSuccess('cam', 'Camera', 'camCard', 'camBtn', 'camIcon', 'camStatus');
            }

            updateSummary();
        }

        function setPermissionSuccess(key, name, cardId, btnId, iconId, statusId) {
            const card = document.getElementById(cardId);
            const btn = document.getElementById(btnId);
            const icon = document.getElementById(iconId);
            const status = document.getElementById(statusId);

            card.className = 'permission-card bg-white border-2 success';
            icon.className = 'fas fa-check text-safety-green text-xl';
            btn.innerHTML = '<i class="fas fa-check"></i>';
            btn.className = 'px-4 py-2 bg-safety-green text-white font-bold text-xs uppercase cursor-default';
            btn.disabled = true;
            status.textContent = 'Previously enabled';
            status.className = 'text-sm text-safety-green mt-1 font-medium';
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
